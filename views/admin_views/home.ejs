<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="stylesheet" type="text/css" href="./css/admin.css">
  <link rel="icon" type="image/png" href="./img/apple.png">
  <title><%= Profile.HoVaTen%> | Quản lý</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bbootstrap 4 -->
  <link rel="stylesheet" href="plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
  <!-- iCheck -->
  <link rel="stylesheet" href="plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- JQVMap -->
  <link rel="stylesheet" href="plugins/jqvmap/jqvmap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css">
  <!-- summernote -->
  <link rel="stylesheet" href="plugins/summernote/summernote-bs4.css">
  <!-- Google Font: Source Sans Pro -->

</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="index3.html" class="nav-link">Trang Chủ</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">Liên Hệ</a>
      </li>
    </ul>

    <!-- SEARCH FORM -->
    <form class="form-inline ml-3">
      <div class="input-group input-group-sm">
        <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
        <div class="input-group-append">
          <button class="btn btn-navbar" type="submit">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
    </form>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
      <!-- Messages Dropdown Menu -->
      <li class="nav-item dropdown">
        <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-comments"></i>
          <span class="badge badge-danger navbar-badge">3</span>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
         
          <a href="#" class="dropdown-item dropdown-footer">Nhìn tất cả tin nhắn</a>
        </div>
      </li>
      <!-- Notifications Dropdown Menu -->
      <li class="nav-item dropdown">
        <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-bell"></i>
          <span class="badge badge-warning navbar-badge">15</span>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          <span class="dropdown-item dropdown-header">15 Thông báo</span>
          <a href="#" class="dropdown-item dropdown-footer">Xem tất cả thông báo</a>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-slide="true" href="/adminLogOut" role="button">
          <i class="fas fa-th-large"></i>
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="https://www.facebook.com/labengoan.cutessss" class="brand-link">
      <img src="dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
           style="opacity: .8">
      <span class="brand-text font-weight-light">Quản Trị Viên</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info">
          <a href="#" class="d-block"> <%= Profile.HoVaTen%></a>
        </div>
      </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item has-treeview menu-open">
            <a href="#" class="nav-link active">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Quản Lý
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
          </li>
          
          
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0 text-dark">Số Liệu</h1>
          </div><!-- /.col -->
         
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <!-- Small boxes (Stat box) -->
        <div class="row">
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-info">
              <div class="inner">
                <h3>150</h3>

                <p>Người dùng mới</p>
              </div>
              <div class="icon">
                <i class="ion ion-bag"></i>
              </div>
              <a href="#" class="small-box-footer">Nhiều thông tin hơn <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-success">
              <div class="inner">
                <h3>53<sup style="font-size: 20px">%</sup></h3>

                <p>Tỷ lệ phát triển</p>
              </div>
              <div class="icon">
                <i class="ion ion-stats-bars"></i>
              </div>
              <a href="#" class="small-box-footer">Nhiều thông tin hơn <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-warning">
              <div class="inner">
                <h3>44</h3>

                <p>Tổng số người dùng</p>
              </div>
              <div class="icon">
                <i class="ion ion-person-add"></i>
              </div>
              <a href="#" class="small-box-footer">Nhiều thông tin hơn <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-danger">
              <div class="inner">
                <h3>65</h3>

                <p>Số người đã ghé qua</p>
              </div>
              <div class="icon">
                <i class="ion ion-pie-graph"></i>
              </div>
              <a href="#" class="small-box-footer">Nhiều thông tin hơn <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
        </div>
        <!-- /.row -->
        <!-- Main row -->
      
        <!-- /.row (main row) -->
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
    <br>
    <div class="content">
      <button class="btn btn-primary mt-0 mb-1" data-toggle="modal" data-target="#createNewActivityAdmin" >Thêm hoạt động điểm danh</button>
    </div>
    <br>
    <div class="content">
      <%- include ("../partials/admin-table-manage") %>
    </div>
    
    <br>
    <div class="content">
        <div class="row">
          <!-- Bảng sự kiện-->
          <div class="col-sm-5" >
            <h4 class="m-0 text-dark">Danh Sách</h4>
            <div class="table-wrapper-scroll-y my-custom-scrollbar">
              <table class="table table-bordered table-striped mb-0 text-center">
                <thead>
                  <tr>
                    <th scope="col">Tên Sự Kiện</th>
                    <th scope="col">Tích Chọn</th>
                    
                  </tr>
                </thead>
                <tbody>
                  
                  <% ListEventUyQuyen.forEach(function(event){ %>
                    <tr>
                      <th scope="row"><%= event.TenSuKien%></th>
                      <td><input type="checkbox" name="tensukien" value='<%-event.TenSuKien %>' id="check_id"></td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          </div>
          <!--Bảng ủy quyền-->
            <div class="col-sm-7" >
              <h4>Phân quyền</h4>
              <!--Tìm kiếm-->
              <div class="row">
                <div class="col-sm-7" >
                  
                </div>
                <div class="col-sm-4" style="margin-bottom:6px">
                  <input class="form-control" type="text" id="searchUser" placeholder="Search" aria-label="Search">
                </div>
              </div>
              
             <!--Kết thúc tìm kiếm-->
              <div class="table-wrapper-scroll-y my-custom-scrollbar">
                <table class="table table-bordered table-striped mb-0 text-center">
                  <thead>
                    <tr>
                      <th scope="col">ID</th>
                      <th scope="col">Vai Trò</th>
                     
                      <th scope="col">Ủy Quyền</th>
                      <th scope="col">Hủy</th>
                     
                    </tr>
                  </thead>
                  <tbody id="TablePhanQuyen">
                    <% PeopleAc.forEach(function(user){ %>
                      <tr>
                        <th scope="row"><%= user.IDTaiKhoan%></th>
                        <td><%= user.LoaiTaiKhoan%></td>
                        
                        <td> <i class="fab fa-hornbill alert-success" data-toggle="modal" data-target="#UyQuyenModel" onclick="authenticateUyQuyen('<%- user.IDTaiKhoan %>')" style="font-size:24px" ></i></td>
                        <td><i class='far fa-stop-circle' data-toggle="modal" data-target="#HuyUyQuyenModel" onclick="authenticateHuyUyQuyen('<%- user.IDTaiKhoan %>')" style='color:red;font-size:24px'></i></td>
                      </tr>
                    <% }); %>
                   
                    
                  </tbody>
                </table>
              </div>
            </div>
        </div>
        
        
    </div>
 
  <!-- /.content-wrapper -->
 

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- Modal - Tạo hoạt động  -->
  <div class="modal fade" id="createNewActivityAdmin" tabindex="-1" role="dialog" aria-labelledby="createNewActModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createNewActModalLabel">Tạo hoạt động</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form action="Admin-create-activity" method="post"class="modal-body">
          <input type="text" name="name" placeholder="Tên hoạt động" class="form-control mb-1" required>
          <input type="text" name="lop" placeholder="Lớp" class="form-control mb-1" required>
          <select name="hocki" placeholder="Học Kỳ" class="form-control mb-1" required>
            <option value="Học Kỳ 1">Học Kỳ 1</option>
            <option value="Học Kỳ 2">Học Kỳ 2</option>
          </select>
          <input type="datetime-local" name="time"  class="form-control" style="height:38px" >
          <div class="input-group mb-1">
            <div class="input-group-append">

            </div>
          </div>
          <input type="password" name="password"  class="form-control bg-success text-danger" style="height:38px" placeholder="Tạo mật khẩu hoạt động"  >
          
          <button class="btn btn-outline-success" type="submit"><i class="fas fa-plus"></i> Tạo</button>
        </form>
      </div>
    </div>
  </div>
      
  <!-- Modal - Xác nhận ủy quyền -->
  <div class="modal fade" id="UyQuyenModel" tabindex="-1" role="dialog" aria-labelledby="UyQuyenModelLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="UyQuyenModelLabel">Xác nhận hành động</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <span id="delActProgress">Bạn có chắc chắn muốn ủy quyền cho người này không?</span>
        </div>
        <div class="modal-footer" id="UyQuyenModelfoot">
          <button class="btn btn-primary" id="xacnhanUyQuyenBtn" onclick="">Ủy Quyền</button>
        </div>
      </div>
    </div>
  </div>
   <!-- Modal - Xác nhận hủy ủy quyền -->
   <div class="modal fade" id="HuyUyQuyenModel" tabindex="-1" role="dialog" aria-labelledby="delActModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="delActModalLabel">Xác nhận hành động</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <span id="delActProgress">Bạn có chắc chắn muốn hủy quyền  người này không?</span>
        </div>
        <div class="modal-footer" id="footDelActModal">
          <button class="btn btn-danger" id="HuyxacnhanUyQuyenBtn" onclick="">Hủy</button>
        </div>
      </div>
    </div>
  </div>
   <!-- Modal - Xóa nhận hoạt động -->
   <div class="modal fade" id="DeleteAcModel" tabindex="-1" role="dialog" aria-labelledby="DeleteAcModelLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="DeleteAcModell">Xác nhận hành động</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <span id="delActProgress">Bạn có chắc chắn muốn xóa hoạt động này không?</span>
        </div>
        <div class="modal-footer" id="XoaATModelfoot">
          <button class="btn btn-danger" id="DeleteAtBtn" onclick="">Xóa</button>
        </div>
      </div>
    </div>
  </div>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->
<footer class="main-footer">
    <p id="IDUserAdmin"> <%= Profile.IDMaAdmin%></p>
</footer>


<!-- jQuery -->
<script src="plugins/jquery/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="plugins/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge('uibutton', $.ui.button)
</script>
<!-- Bootstrap 4 -->
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- daterangepicker -->
<!-- AdminLTE App -->
<script>
  $('#IDUserAdmin').hide();
$(document).ready(function(){
  $("#searchUser").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#TablePhanQuyen tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
});
//Xác nhận ủy quyền
function authenticateUyQuyen(c)
{ 
  $('#xacnhanUyQuyenBtn').attr('onclick',`AJAX_xacNhanUyQuyen('${c}')`);
}
function AJAX_xacNhanUyQuyen(c)
{ 
  $('#UyQuyenModel').modal('hide');
  
                // Khai báo tham số
                var checkbox = document.getElementsByName('tensukien');
                var tensukien = "";
                
                // Lặp qua từng checkbox để lấy giá trị
                for (var i = 0; i < checkbox.length; i++){
                    if (checkbox[i].checked === true){
                      tensukien +=checkbox[i].value;
                        
                          IDUserAdmin=$('#IDUserAdmin').text();
                          $.ajax({type:'POST',
                              url:`/xacnhanUyQuyen?c=${c}`,
                              type:"POST",
                              data:{tensukien,IDUserAdmin},
                              success:function(data){
                                $.notify("Ủy quyền thành công");
                                
                              },error: function(err)
                              { 
                                $.notify("Ủy quyền thất bại");
                              }
                              
                            })
                    }
                }
}

//Hủy ủy quyền
function authenticateHuyUyQuyen(c)
{ 
  $('#HuyxacnhanUyQuyenBtn').attr('onclick',`AJAX_HuyxacNhanUyQuyen('${c}')`);
}
function AJAX_HuyxacNhanUyQuyen(c)
{ 
  $('#HuyUyQuyenModel').modal('hide');
  $.ajax({type:'POST',
      url:`/HuyUyQuyen?c=${c}`,
      type:"POST",
      success:function(data){
        $.notify("Hủy ủy quyền thành công");
        
      },error: function(err)
      { 
        $.notify("Hủy ủy quyền thất bại");
      }
      
    })
}

//Xóa Hoạt động
function authenDeleteAc(c)
    { 
      $('#DeleteAtBtn').attr('onclick',`AJAX_DeleteAtAdmin('${c}')`);
    }
    function AJAX_DeleteAtAdmin(c)
    { 
  $('#DeleteAcModel').modal('hide');
  $.ajax({type:'POST',
      url:`/DeleteAtAdmin?c=${c}`,
      type:"POST",
      success:function(res){
        if(res)
        $.notify(`Hoạt động <b>${res}</b> đã được xóa thành công`, "success");
        setTimeout(`window.location.href="/admin-home"`,3000);
      },error: function(err)
      { 
        $.notify('Không tìm thấy thông tin về hoạt động cần xóa!','error');
      }
      
    })
    }
</script>
<script src="./javascripts/plugins/bootstrap-notify.js"></script>
<script src="dist/js/adminlte.js"></script>

</body>
</html>
